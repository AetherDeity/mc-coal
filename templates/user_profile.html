{% extends "base.html" %}
{% import 'macros.html' as macros %}

{% block title %}{{ edit_user.name }}{% endblock %}

{% block content %}
    <div class="player_list players">
        <div class="box">
            <div class="player wrap {% if edit_user.key == user.key %}you{% endif %}">
                {% if edit_user.username %}<div class="avatar" style="background-image: url(https://minotar.net/helm/{{ edit_user.username }}/40)"></div>{% endif %}
                <div class="name">{{ edit_user.email or edit_user.nickname }}</div>
                <div class="online">
                    <h4>Last COAL Login</h4>
                    <div class="data">{% if edit_user.last_login %}{{ edit_user.last_login|datetimeformat('%b %d, %Y') }}&nbsp;&nbsp;{{ edit_user.last_login|datetimeformat('%I:%M%p') }}{% else %}Never{% endif %}</div>
                </div>
            </div>
        </div>

        <div class="box">
            <form action="{{ uri_for('user_profile', next_url=next_url) }}" method="post">
                <label>Email</label>
                {{ macros.with_errors(form.email, size="50") }}

                <label>Nickname</label>
                {{ macros.with_errors(form.nickname, size="50") }}

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <a class="btn" href="{{ next_url or uri_for('main') }}">Cancel</a>
                </div>
            </form>
        </div>
        <br/>
        <div class="box">
        <h4>Players</h4>
        {% for username in user.usernames %}
            <div class="player wrap {% if user.is_username(username) %}you{% endif %}">
                <div class="avatar" style="background-image: url(https://minotar.net/helm/{{ username }}/40)"></div>
                <div class="name">{{ username }}</div>
            </div>
        {% endfor %}
        </div>
        <br/>
        {% if user.unauthenticated_claims %}
            <div class="box">
            <h4>Unverified Usernames</h4>
            {% for claim in user.unauthenticated_claims %}
                <div class="player wrap">
                    <div class="avatar" style="background-image: url(https://minotar.net/helm/{{ claim.username }}/40)"></div>
                    <div class="name">{{ claim.username }}</div>
                </div>
                <div class="data"><h4>Verification Code (type into minecraft chat):</h4><code>coal:claim:{{ claim.code }}</code></div>
            {% endfor %}
            </div>
        {% endif %}
        <br/>
        <div class="box">
            <form action="{{ uri_for('username_claim', next_url=uri_for('user_profile', next_url=next_url)) }}" method="post">
                <label>Claim Minecraft Username</label>
                {{ macros.with_errors(claim_form.username, size="50") }}
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Claim</button>
                </div>
            </form>
        </div>

    </div>
{% endblock %}
